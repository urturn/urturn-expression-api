var UT={},WD=UT;UT.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=0|16*Math.random(),i="x"==t?e:8|3&e;return i.toString(16)})},UT.UUID=UT.uuid,function(){"use strict";try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(t,e){Object.defineProperty(this,t,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(t,e){Object.defineProperty(this,t,{set:e,enumerable:!0,configurable:!0})}}))}catch(t){throw Error("Simple Storage API not Supported")}}(),UT.touchEventFix=function(t,e){"use strict";function i(){var i=function(){var t=arguments[0],i=arguments[1],n=!0;"touchstart"!==t&&"touchend"!==t&&"touchcancel"!==t&&"touchmove"!==t&&"touchleave"!==t||"function"!=typeof i||(m?(this.__UT__uuid=this.__UT__uuid||l(),g[this.__UT__uuid]=g[this.__UT__uuid]||{},g[this.__UT__uuid][t]={node:this,callback:i}):n=!1),_("_"),_("->> Called addEventListener, type: "+t+", in iframe: "+e+", will be added: "+n),n&&d.apply(this,arguments)},n=function(){var t=arguments[0],e=arguments[1];"touchstart"!==t&&"touchend"!==t&&"touchcancel"!==t&&"touchmove"!==t&&"touchleave"!==t||"function"!=typeof e||g[this.__UT__uuid]&&g[this.__UT__uuid][t]&&delete g[this.__UT__uuid][t],p.apply(this,arguments)};t.Element.prototype.addEventListener=i,t.Element.prototype.removeEventListener=n,t.document.addEventListener=i,t.document.removeEventListener=n}function n(){("TEXTAREA"==t.document.activeElement.nodeName||"INPUT"==t.document.activeElement.nodeName||t.document.activeElement.getAttribute("contenteditable"))&&s()}function r(){var i,n,r,s,o;m=!0,_("->> enableTouchEvents"),e&&t.top.postMessage('"touchevents-enable"',"*");for(var a in g)g.hasOwnProperty(a)&&(i=g[a].touchstart,n=g[a].touchend,r=g[a].touchcancel,s=g[a].touchmove,o=g[a].touchleave,i&&d.call(i.node,"touchstart",i.callback,!1),n&&d.call(n.node,"touchend",n.callback,!1),r&&d.call(r.node,"touchcancel",r.callback,!1),s&&d.call(s.node,"touchmove",s.callback,!1),o&&d.call(o.node,"touchleave",o.callback,!1))}function s(){var i,n,r,s,o;m=!1,_("->> disableTouchEvents"),e&&t.top.postMessage('"touchevents-disable"',"*");for(var a in g)g.hasOwnProperty(a)&&(i=g[a].touchstart,n=g[a].touchend,r=g[a].touchcancel,s=g[a].touchmove,o=g[a].touchleave,i&&p.call(i.node,"touchstart",i.callback,!1),n&&p.call(n.node,"touchend",n.callback,!1),r&&p.call(r.node,"touchcancel",r.callback,!1),s&&p.call(s.node,"touchmove",s.callback,!1),o&&p.call(o.node,"touchleave",o.callback,!1))}function o(){e&&(d.call(t.document,"focus",n,!0),d.call(t.document,"blur",r,!0)),t.addEventListener("message",u,!0)}function a(){e&&(p.call(t.document,"focus",n,!0),p.call(t.document,"blur",r,!0)),t.removeEventListener("message",u,!0)}function u(t){_("didReceiveMessage "+t.data),"touchevents-enable"===t.data?r():"touchevents-disable"===t.data&&s()}function l(){return parseInt(f++,10)}function c(){console.group("EventListeners description:");for(var t in g)console.group("%s:",t),g.hasOwnProperty(t)&&_(g[t]),console.groupEnd();console.groupEnd()}if(!/(iPad|iPhone|iPod)/g.test(t.navigator.userAgent)||!Element.prototype.addEventListener)return null;var h,d=t.Element.prototype.addEventListener,p=t.Element.prototype.removeEventListener,f=0,g={},m=!0,v=!1;i(),o();var _=function(t){v&&console.log(t)};return h={enableCapture:o,disableCapture:a,enableTouchEvents:r,disableTouchEvents:s,getEventListenersDescription:c,didReceiveMessage:u}}(window,!0),__STACK_JQUERY_JS=null,function(t,e,i,n){"use strict";t.Collection=function(e){var i,r,s,o,a,u,l,c,h,d,p=this;this.length=0,this.name=null,this.isPublic=function(){return!1};var f=this.setItem=function(e,i){if(!e)throw Error("InvalidKey",e);if(t.Collection.isReservedKey(e))throw Error("ReservedKey",e);var r=o[e],s=v(e,i);return s||o[e]?(!r||null!==s&&s!==n?!r&&s?(h++,u.push(e),o[e]=s):o[e]=s:(u.splice(u.indexOf(e),1),h--,delete o[e]),-1==l.indexOf(e)&&l.push(e),p.length=u.length,a[e]=i,i):s},g=function(t){return-1===c.indexOf(t)&&p[t]!==n?p[t]:n},m=this.getItem=function(e,i){if(!e)return null;var r=a[e];return r||(r=t.Collection.buildItem(o[e]),r===n&&(r=g(e)),r===n&&(r=i),a[e]=r),r};this.key=function(t){return t>=u.length?null:u[t]},this.count=function(){return h},this.toString=function(){return'<Collection @name="'+p.name+'">'},this.save=function(){k(),x();var e={};if(l.length>0){for(var i=0;l.length>i;i++)e[l[i]]=t.Collection.marshallItem(o[l[i]]);r.save(p.name,e),l=[]}},this.getCurrentData=function(){var t={name:p.name,count:h,definition:s.definition,operations:[],items:[],"public":!1};if(s.operations)for(var e=0;s.operations.length>e;e++){var i={operation:s.operations[e].operation,field:s.operations[e].field};opsToolbox[i.operation].toJsonData(d[i.field],i),t.operations.push(i)}for(var n in o){var r=o[n];r._key=n,t.items.push(r)}return t},this.refresh=function(t){_.call(p,{currentUserId:i,delegate:r,data:t})};var v=t.Collection.sanitizeItem,_=function(e){t.Collection.validateOptions(e),d={},u=[],l=[],c=[],i=e.currentUserId,r=e.delegate,s=e.data,p.name=s.name,h=s.count,y(s.items)},y=function(t){if(o={},a={},t){for(var e=0;t.length>e;e++){var i=t[e],n=i._key;o[n]=i,w(n,i),u.push(n)}p.length=u.length}},w=function(e){-1!=c.indexOf(e)||t.Collection.isReservedKey(e)||(c.push(e),p.__defineGetter__(e,function(){return m.call(p,e)}),p.__defineSetter__(e,function(t){return f.call(p,e,t)}))},b=function(e){for(var i=Object.keys(p),n=i.length-1;n>=0;n--){var r=i[n];t.Collection.isReservedKey(r)||e(r,p[r])}},x=function(){for(var t=p.length-1;t>=0;t--){var e=p.key(t),i=p.getItem(e);i&&i.hasOwnProperty("_dirty")&&i._dirty&&-1===l.indexOf(e)&&(delete i._dirty,p.setItem(e,i))}},k=function(){b(function(t,e){-1===c.indexOf(t)&&(f(t,e),w(t,e))})};_(e)},t.Collection.RESERVED_KEYS=["refresh","setItem","getItem","count","sum","key","isPublic","getUserItem","setUserItem","average","toString","size","length","name","save","fieldDefs","sanitizedItem","getCurrentData"],t.Collection.isReservedKey=function(e){return t.Collection.RESERVED_KEYS.indexOf(e)>=0},t.Collection.validateOptions=function(t){if(!t.data)throw Error("ArgumentError","missing data");if(!t.data.name)throw Error("ArgumentError","no name in data");if(t.data.count===n)throw Error("ArgumentError","no count in data")},t.Collection.marshallItem=function(t){return t&&t.toJSON?t.toJSON():t!==n&&null!==t?t:null},t.Collection.sanitizeItem=function(e,i){if("function"==typeof i)throw Error("ArgumentError cannot serialize function");var n=t.Collection.marshallItem(i);if(null!==n){if(("object"!=typeof n||[].constructor===n.constructor)&&(n={_type:"literal",value:n}),n._key=e,!n||n.constructor!=={}.constructor)throw Error("Unserialisable object");return JSON.parse(JSON.stringify(n))}return null},t.Collection.buildItem=function(e){return e&&e._type&&t.Collection.ItemBuilders[e._type]?t.Collection.ItemBuilders[e._type](e):e},t.Collection.ItemBuilders={image:function(e){return new t.Image(e)},sound:function(e){return new t.Sound(e)},video:function(e){return new t.Video(e)},literal:function(t){return t.value}}}(UT,window,document,void 0),function(t,e,i,n){"use strict";var r=["recent","friends"];t.PublicCollection=function(e){this.length=0,this.name=null;var i=null,s=!1;this.isPublic=function(){return!0},this.setUserItem=function(t){if(!u)throw l.authenticate(),Error("ArgumentError","No currentUserId defined");var e=u,r=a(e,t),o=i;return r||o?(f(o,r),!o||null!==r&&r!==n?!o&&r?(d++,i=r):i=r:(d--,i=null),s=!0,i):r};var o=this.getUserItem=function(){return u?i:n};this.average=function(t){return h[t]?h[t].average:n},this.sum=function(t){return h[t]?h[t].sum:n};var a=function(e,i){var r=t.Collection.sanitizeItem(e,i),s=c.definition.fields;if(i&&s&&s.length>0){for(var o=!1,a=0;s.length>a;a++){var u=s[a];if(i[u.name]!==n)if(o=!0,"string"==u.type)r[u.name]=i[u.name];else if("number"==u.type){var l=parseFloat(i[u.name]);if(isNaN(l)||!isFinite(i[u.name]))throw Error("TypeError","Wrong value for field note");r[u.name]=l}else{if("boolean"!=u.type)throw Error("TypeError","Unknown type "+u.type);r[u.name]=!!i[u.name]}}if(!o)throw Error("InvalidItemError no valid field specified")}return r};this.count=function(t){if(!t)return d;if(h[t])return h[t]?h[t].count:n},this.toString=function(){return'<PublicCollection @name="'+this.name+'">'},this.save=function(){if(s){var e={};e[u]=t.Collection.marshallItem(i),l.save(this.name,e),s=!1}},this.getCurrentData=function(){var t={name:this.name,count:d,definition:c.definition,operations:[],items:[],"public":!0};if(c.operations)for(var e=0;c.operations.length>e;e++){var n={operation:c.operations[e].operation,field:c.operations[e].field};p[n.operation].toJsonData(h[n.field],n),t.operations.push(n)}o()&&(i._key=u,t.items.push(o()));for(var r=0;c.items.length>r;r++)c.items[r]._key&&c.items[r]._key!=u&&t.items.push(c.items[r]);return t},this.find=function(t,e){if("function"==typeof t&&(e=t,t={filters:{recent:!0}}),"string"==typeof t){if(-1===r.indexOf(t))throw Error("invalid filter ("+t+")");var i={};i[t]=!0,t={filters:i}}if(!e||"function"!=typeof e)throw Error("missing callback argument");l.find(this.name,t,e)},this.refresh=function(t){g.call(this,{currentUserId:u,delegate:l,data:t})};var u,l,c,h,d,p={_transfer:function(t,e){for(var i=Array.prototype.slice.call(arguments,2),n=i.length-1;n>=0;n--)e[i[n]]=t[i[n]]},average:{fromJsonData:function(t,e){e.average===n||e.average_count===n?(t.average=-1,t.average_count=0):p._transfer(e,t,"average","average_count")},toJsonData:function(t,e){p._transfer(t,e,"average","average_count")},recompute:function(t,e,i,r){var s=t.average_count;i&&i[e.field]!==n&&(t.average=1===s?-1:(t.average*s-i[e.field])/parseFloat(s-1),s--),r&&r[e.field]!==n&&(t.average=(t.average*s+r[e.field])/parseFloat(s+1),s++),t.average_count=s}},count:{fromJsonData:function(t,e){e.count===n?t.count=0:p._transfer(e,t,"count")},toJsonData:function(t,e){p._transfer(t,e,"count")},recompute:function(t,e,i,r){i&&i[e.field]&&i[e.field]!==n&&(t.count=t.count-1),r&&r[e.field]&&r[e.field]!==n&&t.count++}},sum:{fromJsonData:function(t,e){e.sum===n?t.sum=0:p._transfer(e,t,"sum")},toJsonData:function(t,e){p._transfer(t,e,"sum")},recompute:function(t,e,i,r){i&&i[e.field]&&i[e.field]!==n&&(t.sum=t.sum-i[e.field]),r&&r[e.field]&&r[e.field]!==n&&(t.sum=t.sum+r[e.field])}}},f=function(t,e){if(c.operations)for(var i=0;c.operations.length>i;i++){var r=c.operations[i];(e&&e[r.field]!==n||t&&t[r.field]!==n)&&p[r.operation].recompute(h[r.field],r,t,e)}},g=function(e){if(t.Collection.validateOptions(e),h={},u=e.currentUserId,l=e.delegate,c=e.data,this.name=c.name,d=c.count,c.operations)for(var i=0;c.operations.length>i;i++){var n=c.operations[i];h[n.field]=h[n.field]||{},p[n.operation].fromJsonData(h[n.field],n)}m.call(this,c.items)},m=function(t){if(t)for(var e=0;t.length>e;e++){var n=t[e],r=n._key;r==u&&(i=n)}};g.call(this,e)}}(UT,window,document,void 0),UT.CollectionStore=function(t){this.data=t.data;var e=t.delegate;e.store=this;for(var i={},n=0;this.data.length>n;n++){var r=this.data[n],s=r.name;if(!s)throw Error("ArgumentError","data contains unamed collections.");i[s]=r.public?new UT.PublicCollection({data:r,postMessageApi:t.postMessageApi,currentUserId:t.currentUserId,delegate:e}):new UT.Collection({data:r,postMessageApi:t.postMessageApi,currentUserId:t.currentUserId,delegate:e})}this.get=function(t){return i[t]},this.set=function(t){i[t.name]=t},this.each=function(t){for(var e in i)t(i[e])},this.flush=function(){e.flush()},this.getCurrentData=function(){r=[];for(var t in i)r.push(i[t].getCurrentData());return r},this.refresh=function(t,i){e.refreshCollections(t,i)}};
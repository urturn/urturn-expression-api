var UT={},WD=UT;UT.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=0|16*Math.random(),i="x"==t?e:8|3&e;return i.toString(16)})},UT.UUID=UT.uuid,function(){"use strict";try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(t,e){Object.defineProperty(this,t,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(t,e){Object.defineProperty(this,t,{set:e,enumerable:!0,configurable:!0})}}))}catch(t){throw Error("Simple Storage API not Supported")}}(),UT.touchEventFix=function(t,e){"use strict";function i(){var i=function(){var t=arguments[0],i=arguments[1],o=!0;"touchstart"!==t&&"touchend"!==t&&"touchcancel"!==t&&"touchmove"!==t&&"touchleave"!==t||"function"!=typeof i||(g?(this.__UT__uuid=this.__UT__uuid||u(),m[this.__UT__uuid]=m[this.__UT__uuid]||{},m[this.__UT__uuid][t]={node:this,callback:i}):o=!1),y("_"),y("->> Called addEventListener, type: "+t+", in iframe: "+e+", will be added: "+o),o&&h.apply(this,arguments)},o=function(){var t=arguments[0],e=arguments[1];"touchstart"!==t&&"touchend"!==t&&"touchcancel"!==t&&"touchmove"!==t&&"touchleave"!==t||"function"!=typeof e||m[this.__UT__uuid]&&m[this.__UT__uuid][t]&&delete m[this.__UT__uuid][t],p.apply(this,arguments)};t.Element.prototype.addEventListener=i,t.Element.prototype.removeEventListener=o,t.document.addEventListener=i,t.document.removeEventListener=o}function o(){("TEXTAREA"==t.document.activeElement.nodeName||"INPUT"==t.document.activeElement.nodeName||t.document.activeElement.getAttribute("contenteditable"))&&a()}function n(){var i,o,n,a,s;g=!0,y("->> enableTouchEvents"),e&&t.top.postMessage('"touchevents-enable"',"*");for(var r in m)m.hasOwnProperty(r)&&(i=m[r].touchstart,o=m[r].touchend,n=m[r].touchcancel,a=m[r].touchmove,s=m[r].touchleave,i&&h.call(i.node,"touchstart",i.callback,!1),o&&h.call(o.node,"touchend",o.callback,!1),n&&h.call(n.node,"touchcancel",n.callback,!1),a&&h.call(a.node,"touchmove",a.callback,!1),s&&h.call(s.node,"touchleave",s.callback,!1))}function a(){var i,o,n,a,s;g=!1,y("->> disableTouchEvents"),e&&t.top.postMessage('"touchevents-disable"',"*");for(var r in m)m.hasOwnProperty(r)&&(i=m[r].touchstart,o=m[r].touchend,n=m[r].touchcancel,a=m[r].touchmove,s=m[r].touchleave,i&&p.call(i.node,"touchstart",i.callback,!1),o&&p.call(o.node,"touchend",o.callback,!1),n&&p.call(n.node,"touchcancel",n.callback,!1),a&&p.call(a.node,"touchmove",a.callback,!1),s&&p.call(s.node,"touchleave",s.callback,!1))}function s(){e&&(h.call(t.document,"focus",o,!0),h.call(t.document,"blur",n,!0)),t.addEventListener("message",l,!0)}function r(){e&&(p.call(t.document,"focus",o,!0),p.call(t.document,"blur",n,!0)),t.removeEventListener("message",l,!0)}function l(t){y("didReceiveMessage "+t.data),"touchevents-enable"===t.data?n():"touchevents-disable"===t.data&&a()}function u(){return parseInt(f++,10)}function d(){console.group("EventListeners description:");for(var t in m)console.group("%s:",t),m.hasOwnProperty(t)&&y(m[t]),console.groupEnd();console.groupEnd()}if(!/(iPad|iPhone|iPod)/g.test(t.navigator.userAgent)||!Element.prototype.addEventListener)return null;var c,h=t.Element.prototype.addEventListener,p=t.Element.prototype.removeEventListener,f=0,m={},g=!0,v=!1;i(),s();var y=function(t){v&&console.log(t)};return c={enableCapture:s,disableCapture:r,enableTouchEvents:n,disableTouchEvents:a,getEventListenersDescription:d,didReceiveMessage:l}}(window,!0),__STACK_JQUERY_JS=null,function(t,e,i,o){"use strict";t.Collection=function(e){var i,n,a,s,r,l,u,d,c,h,p=this;this.length=0,this.name=null,this.isPublic=function(){return!1};var f=this.setItem=function(e,i){if(!e)throw Error("InvalidKey",e);if(t.Collection.isReservedKey(e))throw Error("ReservedKey",e);var n=s[e],a=v(e,i);return a||s[e]?(!n||null!==a&&a!==o?!n&&a?(c++,l.push(e),s[e]=a):s[e]=a:(l.splice(l.indexOf(e),1),c--,delete s[e]),-1==u.indexOf(e)&&u.push(e),p.length=l.length,r[e]=i,i):a},m=function(t){return-1===d.indexOf(t)&&p[t]!==o?p[t]:o},g=this.getItem=function(e,i){if(!e)return null;var n=r[e];return n||(n=t.Collection.buildItem(s[e]),n===o&&(n=m(e)),n===o&&(n=i),r[e]=n),n};this.key=function(t){return t>=l.length?null:l[t]},this.count=function(){return c},this.toString=function(){return'<Collection @name="'+p.name+'">'},this.save=function(){k(),P();var e={};if(u.length>0){for(var i=0;u.length>i;i++)e[u[i]]=t.Collection.marshallItem(s[u[i]]);n.save(p.name,e),u=[]}},this.getCurrentData=function(){var t={name:p.name,count:c,definition:a.definition,operations:[],items:[],"public":!1};if(a.operations)for(var e=0;a.operations.length>e;e++){var i={operation:a.operations[e].operation,field:a.operations[e].field};opsToolbox[i.operation].toJsonData(h[i.field],i),t.operations.push(i)}for(var o in s){var n=s[o];n._key=o,t.items.push(n)}return t},this.refresh=function(t){y.call(p,{currentUserId:i,delegate:n,data:t})};var v=t.Collection.sanitizeItem,y=function(e){t.Collection.validateOptions(e),h={},l=[],u=[],d=[],i=e.currentUserId,n=e.delegate,a=e.data,p.name=a.name,c=a.count,_(a.items)},_=function(t){if(s={},r={},t){for(var e=0;t.length>e;e++){var i=t[e],o=i._key;s[o]=i,w(o,i),l.push(o)}p.length=l.length}},w=function(e){-1!=d.indexOf(e)||t.Collection.isReservedKey(e)||(d.push(e),p.__defineGetter__(e,function(){return g.call(p,e)}),p.__defineSetter__(e,function(t){return f.call(p,e,t)}))},b=function(e){for(var i=Object.keys(p),o=i.length-1;o>=0;o--){var n=i[o];t.Collection.isReservedKey(n)||e(n,p[n])}},P=function(){for(var t=p.length-1;t>=0;t--){var e=p.key(t),i=p.getItem(e);i&&i.hasOwnProperty("_dirty")&&i._dirty&&-1===u.indexOf(e)&&(delete i._dirty,p.setItem(e,i))}},k=function(){b(function(t,e){-1===d.indexOf(t)&&(f(t,e),w(t,e))})};y(e)},t.Collection.RESERVED_KEYS=["refresh","setItem","getItem","count","sum","key","isPublic","getUserItem","setUserItem","average","toString","size","length","name","save","fieldDefs","sanitizedItem","getCurrentData"],t.Collection.isReservedKey=function(e){return t.Collection.RESERVED_KEYS.indexOf(e)>=0},t.Collection.validateOptions=function(t){if(!t.data)throw Error("ArgumentError","missing data");if(!t.data.name)throw Error("ArgumentError","no name in data");if(t.data.count===o)throw Error("ArgumentError","no count in data")},t.Collection.marshallItem=function(t){return t&&t.toJSON?t.toJSON():t!==o&&null!==t?t:null},t.Collection.sanitizeItem=function(e,i){if("function"==typeof i)throw Error("ArgumentError cannot serialize function");var o=t.Collection.marshallItem(i);if(null!==o){if(("object"!=typeof o||[].constructor===o.constructor)&&(o={_type:"literal",value:o}),o._key=e,!o||o.constructor!=={}.constructor)throw Error("Unserialisable object");return JSON.parse(JSON.stringify(o))}return null},t.Collection.buildItem=function(e){return e&&e._type&&t.Collection.ItemBuilders[e._type]?t.Collection.ItemBuilders[e._type](e):e},t.Collection.ItemBuilders={image:function(e){return new t.Image(e)},sound:function(e){return new t.Sound(e)},video:function(e){return new t.Video(e)},literal:function(t){return t.value}}}(UT,window,document,void 0),function(t,e,i,o){"use strict";var n=["recent","friends"];t.PublicCollection=function(e){this.length=0,this.name=null;var i=null,a=!1;this.isPublic=function(){return!0},this.setUserItem=function(t){if(!l)throw u.authenticate(),Error("ArgumentError","No currentUserId defined");var e=l,n=r(e,t),s=i;return n||s?(f(s,n),!s||null!==n&&n!==o?!s&&n?(h++,i=n):i=n:(h--,i=null),a=!0,i):n};var s=this.getUserItem=function(){return l?i:o};this.average=function(t){return c[t]?c[t].average:o},this.sum=function(t){return c[t]?c[t].sum:o};var r=function(e,i){var n=t.Collection.sanitizeItem(e,i),a=d.definition.fields;if(i&&a&&a.length>0){for(var s=!1,r=0;a.length>r;r++){var l=a[r];if(i[l.name]!==o)if(s=!0,"string"==l.type)n[l.name]=i[l.name];else if("number"==l.type){var u=parseFloat(i[l.name]);if(isNaN(u)||!isFinite(i[l.name]))throw Error("TypeError","Wrong value for field note");n[l.name]=u}else{if("boolean"!=l.type)throw Error("TypeError","Unknown type "+l.type);n[l.name]=!!i[l.name]}}if(!s)throw Error("InvalidItemError no valid field specified")}return n};this.count=function(t){if(!t)return h;if(c[t])return c[t]?c[t].count:o},this.toString=function(){return'<PublicCollection @name="'+this.name+'">'},this.save=function(){if(a){var e={};e[l]=t.Collection.marshallItem(i),u.save(this.name,e),a=!1}},this.getCurrentData=function(){var t={name:this.name,count:h,definition:d.definition,operations:[],items:[],"public":!0};if(d.operations)for(var e=0;d.operations.length>e;e++){var o={operation:d.operations[e].operation,field:d.operations[e].field};p[o.operation].toJsonData(c[o.field],o),t.operations.push(o)}s()&&(i._key=l,t.items.push(s()));for(var n=0;d.items.length>n;n++)d.items[n]._key&&d.items[n]._key!=l&&t.items.push(d.items[n]);return t},this.find=function(t,e){if("function"==typeof t&&(e=t,t={filters:{recent:!0}}),"string"==typeof t){if(-1===n.indexOf(t))throw Error("invalid filter ("+t+")");var i={};i[t]=!0,t={filters:i}}if(!e||"function"!=typeof e)throw Error("missing callback argument");u.find(this.name,t,e)},this.refresh=function(t){m.call(this,{currentUserId:l,delegate:u,data:t})};var l,u,d,c,h,p={_transfer:function(t,e){for(var i=Array.prototype.slice.call(arguments,2),o=i.length-1;o>=0;o--)e[i[o]]=t[i[o]]},average:{fromJsonData:function(t,e){e.average===o||e.average_count===o?(t.average=-1,t.average_count=0):p._transfer(e,t,"average","average_count")},toJsonData:function(t,e){p._transfer(t,e,"average","average_count")},recompute:function(t,e,i,n){var a=t.average_count;i&&i[e.field]!==o&&(t.average=1===a?-1:(t.average*a-i[e.field])/parseFloat(a-1),a--),n&&n[e.field]!==o&&(t.average=(t.average*a+n[e.field])/parseFloat(a+1),a++),t.average_count=a}},count:{fromJsonData:function(t,e){e.count===o?t.count=0:p._transfer(e,t,"count")},toJsonData:function(t,e){p._transfer(t,e,"count")},recompute:function(t,e,i,n){i&&i[e.field]&&i[e.field]!==o&&(t.count=t.count-1),n&&n[e.field]&&n[e.field]!==o&&t.count++}},sum:{fromJsonData:function(t,e){e.sum===o?t.sum=0:p._transfer(e,t,"sum")},toJsonData:function(t,e){p._transfer(t,e,"sum")},recompute:function(t,e,i,n){i&&i[e.field]&&i[e.field]!==o&&(t.sum=t.sum-i[e.field]),n&&n[e.field]&&n[e.field]!==o&&(t.sum=t.sum+n[e.field])}}},f=function(t,e){if(d.operations)for(var i=0;d.operations.length>i;i++){var n=d.operations[i];(e&&e[n.field]!==o||t&&t[n.field]!==o)&&p[n.operation].recompute(c[n.field],n,t,e)}},m=function(e){if(t.Collection.validateOptions(e),c={},l=e.currentUserId,u=e.delegate,d=e.data,this.name=d.name,h=d.count,d.operations)for(var i=0;d.operations.length>i;i++){var o=d.operations[i];c[o.field]=c[o.field]||{},p[o.operation].fromJsonData(c[o.field],o)}g.call(this,d.items)},g=function(t){if(t)for(var e=0;t.length>e;e++){var o=t[e],n=o._key;n==l&&(i=o)}};m.call(this,e)}}(UT,window,document,void 0),UT.CollectionStore=function(t){this.data=t.data;var e=t.delegate;e.store=this;for(var i={},o=0;this.data.length>o;o++){var n=this.data[o],a=n.name;if(!a)throw Error("ArgumentError","data contains unamed collections.");i[a]=n.public?new UT.PublicCollection({data:n,postMessageApi:t.postMessageApi,currentUserId:t.currentUserId,delegate:e}):new UT.Collection({data:n,postMessageApi:t.postMessageApi,currentUserId:t.currentUserId,delegate:e})}this.get=function(t){return i[t]},this.set=function(t){i[t.name]=t},this.each=function(t){for(var e in i)t(i[e])},this.flush=function(){e.flush()},this.getCurrentData=function(){n=[];for(var t in i)n.push(i[t].getCurrentData());return n},this.refresh=function(t,i){e.refreshCollections(t,i)}};
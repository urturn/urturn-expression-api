var UT={},WD=UT;UT.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)})},UT.UUID=UT.uuid,function(){"use strict";try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(e,t){Object.defineProperty(this,e,{get:t,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(e,t){Object.defineProperty(this,e,{set:t,enumerable:!0,configurable:!0})}}))}catch(e){throw Error("Simple Storage API not Supported")}}(),UT.touchEventFix=function(e,t){"use strict";function n(){var n=function(){var e=arguments[0],n=arguments[1],o=!0;"touchstart"!==e&&"touchend"!==e&&"touchcancel"!==e&&"touchmove"!==e&&"touchleave"!==e||"function"!=typeof n||(v?(this.__UT__uuid=this.__UT__uuid||c(),m[this.__UT__uuid]=m[this.__UT__uuid]||{},m[this.__UT__uuid][e]={node:this,callback:n}):o=!1),y("_"),y("->> Called addEventListener, type: "+e+", in iframe: "+t+", will be added: "+o),o&&d.apply(this,arguments)},o=function(){var e=arguments[0],t=arguments[1];"touchstart"!==e&&"touchend"!==e&&"touchcancel"!==e&&"touchmove"!==e&&"touchleave"!==e||"function"!=typeof t||m[this.__UT__uuid]&&m[this.__UT__uuid][e]&&delete m[this.__UT__uuid][e],h.apply(this,arguments)};e.Element.prototype.addEventListener=n,e.Element.prototype.removeEventListener=o,e.document.addEventListener=n,e.document.removeEventListener=o}function o(){("TEXTAREA"==e.document.activeElement.nodeName||"INPUT"==e.document.activeElement.nodeName||e.document.activeElement.getAttribute("contenteditable"))&&i()}function r(){var n,o,r,i,a;v=!0,y("->> enableTouchEvents"),t&&e.top.postMessage('"touchevents-enable"',"*");for(var s in m)m.hasOwnProperty(s)&&(n=m[s].touchstart,o=m[s].touchend,r=m[s].touchcancel,i=m[s].touchmove,a=m[s].touchleave,n&&d.call(n.node,"touchstart",n.callback,!1),o&&d.call(o.node,"touchend",o.callback,!1),r&&d.call(r.node,"touchcancel",r.callback,!1),i&&d.call(i.node,"touchmove",i.callback,!1),a&&d.call(a.node,"touchleave",a.callback,!1))}function i(){var n,o,r,i,a;v=!1,y("->> disableTouchEvents"),t&&e.top.postMessage('"touchevents-disable"',"*");for(var s in m)m.hasOwnProperty(s)&&(n=m[s].touchstart,o=m[s].touchend,r=m[s].touchcancel,i=m[s].touchmove,a=m[s].touchleave,n&&h.call(n.node,"touchstart",n.callback,!1),o&&h.call(o.node,"touchend",o.callback,!1),r&&h.call(r.node,"touchcancel",r.callback,!1),i&&h.call(i.node,"touchmove",i.callback,!1),a&&h.call(a.node,"touchleave",a.callback,!1))}function a(){t&&(d.call(e.document,"focus",o,!0),d.call(e.document,"blur",r,!0)),e.addEventListener("message",l,!0)}function s(){t&&(h.call(e.document,"focus",o,!0),h.call(e.document,"blur",r,!0)),e.removeEventListener("message",l,!0)}function l(e){y("didReceiveMessage "+e.data),"touchevents-enable"===e.data?r():"touchevents-disable"===e.data&&i()}function c(){return parseInt(p++,10)}function u(){console.group("EventListeners description:");for(var e in m)console.group("%s:",e),m.hasOwnProperty(e)&&y(m[e]),console.groupEnd();console.groupEnd()}if(!/(iPad|iPhone|iPod)/g.test(e.navigator.userAgent)||!Element.prototype.addEventListener)return null;var f,d=e.Element.prototype.addEventListener,h=e.Element.prototype.removeEventListener,p=0,m={},v=!0,g=!1;n(),a();var y=function(e){g&&console.log(e)};return f={enableCapture:a,disableCapture:s,enableTouchEvents:r,disableTouchEvents:i,getEventListenersDescription:u,didReceiveMessage:l}}(window,!0),__STACK_JQUERY_JS=null,function(e,t,n,o){"use strict";e.Collection=function(t){var n,r,i,a,s,l,c,u,f,d,h=this;this.length=0,this.name=null,this.isPublic=function(){return!1};var p=this.setItem=function(t,n){if(!t)throw Error("InvalidKey",t);if(e.Collection.isReservedKey(t))throw Error("ReservedKey",t);var r=a[t],i=g(t,n);return i||a[t]?(!r||null!==i&&i!==o?!r&&i?(f++,l.push(t),a[t]=i):a[t]=i:(l.splice(l.indexOf(t),1),f--,delete a[t]),-1==c.indexOf(t)&&c.push(t),h.length=l.length,s[t]=n,n):i},m=function(e){return-1===u.indexOf(e)&&h[e]!==o?h[e]:o},v=this.getItem=function(t,n){if(!t)return null;var r=s[t];return r||(r=e.Collection.buildItem(a[t]),r===o&&(r=m(t)),r===o&&(r=n),s[t]=r),r};this.key=function(e){return e>=l.length?null:l[e]},this.count=function(){return f},this.toString=function(){return'<Collection @name="'+h.name+'">'},this.save=function(){b();var t={};if(c.length>0){for(var n=0;c.length>n;n++)t[c[n]]=e.Collection.marshallItem(a[c[n]]);r.save(h.name,t),c=[]}},this.getCurrentData=function(){var e={name:h.name,count:f,definition:i.definition,operations:[],items:[],"public":!1};if(i.operations)for(var t=0;i.operations.length>t;t++){var n={operation:i.operations[t].operation,field:i.operations[t].field};opsToolbox[n.operation].toJsonData(d[n.field],n),e.operations.push(n)}for(var o in a){var r=a[o];r._key=o,e.items.push(r)}return e},this.refresh=function(e){y.call(h,{currentUserId:n,delegate:r,data:e})};var g=e.Collection.sanitizeItem,y=function(t){e.Collection.validateOptions(t),d={},l=[],c=[],u=[],n=t.currentUserId,r=t.delegate,i=t.data,h.name=i.name,f=i.count,_(i.items)},_=function(e){if(a={},s={},e){for(var t=0;e.length>t;t++){var n=e[t],o=n._key;a[o]=n,E(o,n),l.push(o)}h.length=l.length}},E=function(t){-1!=u.indexOf(t)||e.Collection.isReservedKey(t)||(u.push(t),h.__defineGetter__(t,function(){return v.call(h,t)}),h.__defineSetter__(t,function(e){return p.call(h,t,e)}))},b=function(){for(var t=Object.keys(h),n=t.length-1;n>=0;n--){var o=t[n];e.Collection.isReservedKey(o)||-1!=u.indexOf(o)||(p(o,h[o]),E(o,h[o]))}};y(t)},e.Collection.RESERVED_KEYS=["refresh","setItem","getItem","count","sum","key","isPublic","getUserItem","setUserItem","average","toString","size","length","name","save","fieldDefs","sanitizedItem","getCurrentData"],e.Collection.isReservedKey=function(t){return e.Collection.RESERVED_KEYS.indexOf(t)>=0},e.Collection.validateOptions=function(e){if(!e.data)throw Error("ArgumentError","missing data");if(!e.data.name)throw Error("ArgumentError","no name in data");if(e.data.count===o)throw Error("ArgumentError","no count in data")},e.Collection.marshallItem=function(e){return e&&e.marshall?e.marshall():e!==o&&null!==e?e:null},e.Collection.sanitizeItem=function(t,n){if("function"==typeof n)throw Error("ArgumentError cannot serialize function");var o=e.Collection.marshallItem(n);if(null!==o){if(("object"!=typeof o||[].constructor===o.constructor)&&(o={_type:"literal",value:o}),o._key=t,!o||o.constructor!=={}.constructor)throw Error("Unserialisable object");return JSON.parse(JSON.stringify(o))}return null},e.Collection.buildItem=function(t){return t&&t._type&&e.Collection.ItemBuilders[t._type]?e.Collection.ItemBuilders[t._type](t):t},e.Collection.ItemBuilders={image:function(t){return new e.Image(t)},sound:function(t){return new e.Sound(t)},video:function(t){return new e.Video(t)},literal:function(e){return e.value}}}(UT,window,document,void 0),function(e,t,n,o){"use strict";var r=["recent","friends"];e.PublicCollection=function(t){this.length=0,this.name=null;var n=null,i=!1;this.isPublic=function(){return!0},this.setUserItem=function(e){if(!l)throw c.authenticate(),Error("ArgumentError","No currentUserId defined");var t=l,r=s(t,e),a=n;return r||a?(p(a,r),!a||null!==r&&r!==o?!a&&r?(d++,n=r):n=r:(d--,n=null),i=!0,n):r};var a=this.getUserItem=function(){return l?n:o};this.average=function(e){return f[e]?f[e].average:o},this.sum=function(e){return f[e]?f[e].sum:o};var s=function(t,n){var r=e.Collection.sanitizeItem(t,n),i=u.definition.fields;if(n&&i&&i.length>0){for(var a=!1,s=0;i.length>s;s++){var l=i[s];if(n[l.name]!==o)if(a=!0,"string"==l.type)r[l.name]=n[l.name];else if("number"==l.type){var c=parseFloat(n[l.name]);if(isNaN(c)||!isFinite(n[l.name]))throw Error("TypeError","Wrong value for field note");r[l.name]=c}else{if("boolean"!=l.type)throw Error("TypeError","Unknown type "+l.type);r[l.name]=!!n[l.name]}}if(!a)throw Error("InvalidItemError no valid field specified")}return r};this.count=function(e){if(!e)return d;if(f[e])return f[e]?f[e].count:o},this.toString=function(){return'<PublicCollection @name="'+this.name+'">'},this.save=function(){if(i){var t={};t[l]=e.Collection.marshallItem(n),c.save(this.name,t),i=!1}},this.getCurrentData=function(){var e={name:this.name,count:d,definition:u.definition,operations:[],items:[],"public":!0};if(u.operations)for(var t=0;u.operations.length>t;t++){var o={operation:u.operations[t].operation,field:u.operations[t].field};h[o.operation].toJsonData(f[o.field],o),e.operations.push(o)}a()&&(n._key=l,e.items.push(a()));for(var r=0;u.items.length>r;r++)u.items[r]._key&&u.items[r]._key!=l&&e.items.push(u.items[r]);return e},this.find=function(e,t){if("function"==typeof e&&(t=e,e={filters:{recent:!0}}),"string"==typeof e){if(-1===r.indexOf(e))throw Error("invalid filter ("+e+")");var n={};n[e]=!0,e={filters:n}}if(!t||"function"!=typeof t)throw Error("missing callback argument");c.find(this.name,e,t)},this.refresh=function(e){m.call(this,{currentUserId:l,delegate:c,data:e})};var l,c,u,f,d,h={_transfer:function(e,t){for(var n=Array.prototype.slice.call(arguments,2),o=n.length-1;o>=0;o--)t[n[o]]=e[n[o]]},average:{fromJsonData:function(e,t){t.average===o||t.average_count===o?(e.average=-1,e.average_count=0):h._transfer(t,e,"average","average_count")},toJsonData:function(e,t){h._transfer(e,t,"average","average_count")},recompute:function(e,t,n,r){var i=e.average_count;n&&n[t.field]!==o&&(e.average=1===i?-1:(e.average*i-n[t.field])/parseFloat(i-1),i--),r&&r[t.field]!==o&&(e.average=(e.average*i+r[t.field])/parseFloat(i+1),i++),e.average_count=i}},count:{fromJsonData:function(e,t){t.count===o?e.count=0:h._transfer(t,e,"count")},toJsonData:function(e,t){h._transfer(e,t,"count")},recompute:function(e,t,n,r){n&&n[t.field]&&n[t.field]!==o&&(e.count=e.count-1),r&&r[t.field]&&r[t.field]!==o&&e.count++}},sum:{fromJsonData:function(e,t){t.sum===o?e.sum=0:h._transfer(t,e,"sum")},toJsonData:function(e,t){h._transfer(e,t,"sum")},recompute:function(e,t,n,r){n&&n[t.field]&&n[t.field]!==o&&(e.sum=e.sum-n[t.field]),r&&r[t.field]&&r[t.field]!==o&&(e.sum=e.sum+r[t.field])}}},p=function(e,t){if(u.operations)for(var n=0;u.operations.length>n;n++){var r=u.operations[n];(t&&t[r.field]!==o||e&&e[r.field]!==o)&&h[r.operation].recompute(f[r.field],r,e,t)}},m=function(t){if(e.Collection.validateOptions(t),f={},l=t.currentUserId,c=t.delegate,u=t.data,this.name=u.name,d=u.count,u.operations)for(var n=0;u.operations.length>n;n++){var o=u.operations[n];f[o.field]=f[o.field]||{},h[o.operation].fromJsonData(f[o.field],o)}v.call(this,u.items)},v=function(e){if(e)for(var t=0;e.length>t;t++){var o=e[t],r=o._key;r==l&&(n=o)}};m.call(this,t)}}(UT,window,document,void 0),UT.CollectionStore=function(e){this.data=e.data;var t=e.delegate;t.store=this;for(var n={},o=0;this.data.length>o;o++){var r=this.data[o],i=r.name;if(!i)throw Error("ArgumentError","data contains unamed collections.");n[i]=r.public?new UT.PublicCollection({data:r,postMessageApi:e.postMessageApi,currentUserId:e.currentUserId,delegate:t}):new UT.Collection({data:r,postMessageApi:e.postMessageApi,currentUserId:e.currentUserId,delegate:t})}this.get=function(e){return n[e]},this.set=function(e){n[e.name]=e},this.each=function(e){for(var t in n)e(n[t])},this.flush=function(){t.flush()},this.getCurrentData=function(){r=[];for(var e in n)r.push(n[e].getCurrentData());return r},this.refresh=function(e,n){t.refreshCollections(e,n)}};
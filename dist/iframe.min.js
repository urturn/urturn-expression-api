function FastClick(e){"use strict";var t,n=this;this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.layer=e;if(!e||!e.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){FastClick.prototype.onClick.apply(n,arguments)},this.onTouchStart=function(){FastClick.prototype.onTouchStart.apply(n,arguments)},this.onTouchMove=function(){FastClick.prototype.onTouchMove.apply(n,arguments)},this.onTouchEnd=function(){FastClick.prototype.onTouchEnd.apply(n,arguments)},this.onTouchCancel=function(){FastClick.prototype.onTouchCancel.apply(n,arguments)};if(typeof window.ontouchstart=="undefined")return;e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,n,r){var i=Node.prototype.removeEventListener;t==="click"?i.call(e,t,n.hijacked||n,r):i.call(e,t,n,r)},e.addEventListener=function(t,n,r){var i=Node.prototype.addEventListener;t==="click"?i.call(e,t,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(e,t,n,r)}),typeof e.onclick=="function"&&(t=e.onclick,e.addEventListener("click",function(e){t(e)},!1),e.onclick=null)}var UT={},WD=UT;UT.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},UT.UUID=UT.uuid,UT.Collection=function(e){this.length=0,this.name=null,this.setUserItem=function(e){if(!r)throw i.authenticate(),"ArgumentError: no currentUserId defined";return this.setItem(r,e)},this.getUserItem=function(e){if(!r)return;return this.getItem(r)};var t=function(e,t){if(!e)throw"invalid key: "+e;if(h.indexOf(e)!=-1)throw"reserved key: "+e;var n=v(e,t),r=null;return e&&(r=this.getItem(e)),d(r,n),!r||n!==null&&typeof n!="undefined"?!r&&n?(c++,a.push(e),o[e]=n):o[e]=n:(a.splice(a.indexOf(e),1),c--,delete o[e]),t&&(t._key=e),f.indexOf(e)==-1&&f.push(e),this.length=a.length,t};this.setItem=t;var n=function(e,t){if(!e)return null;var n=o[e];return n===undefined?l.indexOf(e)===-1&&this[e]!==undefined?this[e]:t:n._type=="literal"?n.value:n};this.getItem=n,this.key=function(e){return e>=a.length?null:a[e]},this.average=function(e){if(!u[e])return;return u[e].average},this.sum=function(e){if(!u[e])return;return u[e].sum},this.count=function(e){if(!e)return c;if(!u[e])return;if(u[e])return u[e].count},this.toString=function(){return'<Collection @name="'+this.name+'">'},this.save=function(){b.apply(this);var e={};if(f.length>0){for(var t=0;t<f.length;t++)e[f[t]]=o[f[t]];i.save(this.name,e),f=[]}},this.getCurrentData=function(){var e={name:this.name,count:c,definition:s.definition,operations:[],items:[]};if(s.operations)for(var t=0;t<s.operations.length;t++){var n={operation:s.operations[t].operation,field:s.operations[t].field};p[n.operation].toJsonData(u[n.field],n),e.operations.push(n)}for(var r in o){var i=o[r];i._key=r,e.items.push(i)}return e},this.refresh=function(e){m.call(this,{currentUserId:r,delegate:i,data:e})};var r,i,s,o,u,a,f,l,c,h=["refresh","setItem","getItem","count","sum","key","getUserItem","setUserItem","average","toString","size","length","length","name","save","fieldDefs","sanitizedItem","getCurrentData"],p={_transfer:function(e,t){var n=Array.prototype.slice.call(arguments,2);for(var r=n.length-1;r>=0;r--)t[n[r]]=e[n[r]]},average:{fromJsonData:function(e,t){t.average===undefined||t.average_count===undefined?(e.average=-1,e.average_count=0):p._transfer(t,e,"average","average_count")},toJsonData:function(e,t){p._transfer(e,t,"average","average_count")},recompute:function(e,t,n,r){var i=e.average_count;n&&n[t.field]!==undefined&&(e.average=(e.average*i-n[t.field])/parseFloat(i-1),i--),r&&r[t.field]!==undefined&&(e.average=(e.average*i+r[t.field])/parseFloat(i+1),i++),e.average_count=i}},count:{fromJsonData:function(e,t){t.count===undefined?e.count=0:p._transfer(t,e,"count")},toJsonData:function(e,t){p._transfer(e,t,"count")},recompute:function(e,t,n,r){n&&n[t.field]&&n[t.field]!==undefined&&(e.count=e.count-1),r&&r[t.field]&&r[t.field]!==undefined&&e.count++}},sum:{fromJsonData:function(e,t){t.sum===undefined?e.sum=0:p._transfer(t,e,"sum")},toJsonData:function(e,t){p._transfer(e,t,"sum")},recompute:function(e,t,n,r){n&&n[t.field]&&n[t.field]!==undefined&&(e.sum=e.sum-n[t.field]),r&&r[t.field]&&r[t.field]!==undefined&&(e.sum=e.sum+r[t.field])}}},d=function(e,t){if(s.operations)for(var n=0;n<s.operations.length;n++){var r=s.operations[n];(t&&t[r.field]!==undefined||e&&e[r.field]!==undefined)&&p[r.operation].recompute(u[r.field],r,e,t)}},v=function(e,t){if(typeof t!="object"||Array.isArray&&Array.isArray(t))t={_type:"literal",value:t};if(!t)return null;sanitizedItem={_key:e};var n;if(s.definition&&(n=s.definition.fields)&&n.length>0)for(var r=0;r<n.length;r++){var i=n[r];if(typeof t[i.name]!="undefined")if(i.type=="string")sanitizedItem[i.name]=t[i.name];else if(i.type=="number"){var o=parseFloat(t[i.name]);if(!!isNaN(o)||!isFinite(t[i.name]))throw"TypeError: wrong value for field note";sanitizedItem[i.name]=o}else{if(i.type!="boolean")throw"TypeError: Unkown type "+i.type;sanitizedItem[i.name]=!!t[i.name]}}else sanitizedItem=t,sanitizedItem._key=e;return sanitizedItem},m=function(e){if(!e.data)throw"ArgumentError: missing data";if(!e.data.name)throw"ArgumentError: no name in data";if(e.data.count===undefined)throw"ArgumentError: no count in data";u={},a=[],f=[],l=[],r=e.currentUserId,i=e.delegate,s=e.data,this.name=s.name,c=s.count;if(s.operations)for(var t=0;t<s.operations.length;t++){var n=s.operations[t];u[n.field]=u[n.field]||{},p[n.operation].fromJsonData(u[n.field],n)}g.call(this,s.items)},g=function(e){o={};if(!e)return;for(var t=0;t<e.length;t++){var n=e[t],r=n._key;o[r]=n,y.call(this,r,n),a.push(r)}this.length=a.length},y=function(e,r){l.indexOf(e)==-1&&h.indexOf(e)==-1&&(l.push(e),this.__defineGetter__(e,function(){return n.call(this,e)}),this.__defineSetter__(e,function(n){return t.call(this,e,n)}))},b=function(){var e=Object.keys(this);for(var n=e.length-1;n>=0;n--){var r=e[n];h.indexOf(r)==-1&&l.indexOf(r)==-1&&(t.call(this,r,this[r]),y.call(this,r,this[r]))}};m.call(this,e)};var supportGetSet=function(){try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(e,t){Object.defineProperty(this,e,{get:t,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(e,t){Object.defineProperty(this,e,{set:t,enumerable:!0,configurable:!0})}}))}catch(e){throw"Simple Storage API not Supported"}};supportGetSet(),UT.CollectionStore=function(e){this.data=e.data;var t=e.delegate;t.store=this;var n={};for(var r=0;r<this.data.length;r++){var i=this.data[r],s=i.name;if(!s)throw"ArgumentError: data contains unamed collections.";n[s]=new UT.Collection({data:i,postMessageApi:e.postMessageApi,currentUserId:e.currentUserId,delegate:t})}this.get=function(e){return n[e]},this.set=function(e){n[e.name]=e},this.flush=function(e){t.flush()},this.getCurrentData=function(){i=[];for(var e in n)i.push(n[e].getCurrentData());return i},this.refresh=function(e,n){t.refreshCollections(e,n)}},UT.Expression=function(){function a(e,t){s=null,o.push({name:e,module:t})}function f(e){this._getInstance().bind("ready",e),s.isReady&&e.apply(this,[s]);if("ontouchstart"in window||"onmsgesturechange"in window)document.querySelector("html").className=document.querySelector("html").className+" touch",typeof FastClick!="undefined"&&window.addEventListener("load",function(){new FastClick(document.body)},!1);return s}function l(e,t,n){var r={type:"ExpAPICall",methodName:e,args:t,expToken:i?i.expToken:null};if(n){var s=UT.uuid().toString();u[s]=n,r.callbackId=s}var o=JSON.stringify(r);window.parent.postMessage(o,"*")}function c(){return s=s||p({}),s}function h(){s=null}function p(t){function a(t){var n=s[t],r=[],i="after"+t.charAt(0).toUpperCase()+t.slice(1),o,u,f,l,c;if(!n)return;n=n.slice(0),o=n.length,u=-1,l=Array.prototype.slice.call(arguments,1);while(++u<o)f=n[u],c=f.apply(e,l),c&&typeof c.then=="function"&&r.push(c);r.length>0?when.all(r).then(function(){a(i)}):a(i)}function f(e,t){var n=s[e]||(s[e]=[]);if(typeof t!="function")return;n.push(t)}function l(e,t){var n=s[e],r;if(!n)return;if(!t){delete s[e];return}r=n?n.indexOf(t):-1;while(r!==-1)n.splice(r,1),r=n.indexOf(t)}function c(e){n=e}function h(e){typeof e=="string"?(i.note=e,UT.Expression._callAPI("document.setNote",[e],function(){})):console.error("note should be a string (expression.setNote)")}function p(e){return e!==undefined&&e!=i.readyToPost&&(i.readyToPost=!!e,UT.Expression._callAPI("document.readyToPost",[i.readyToPost],function(){})),i.readyToPost}function d(){return i.note}function v(e){f("modeChanged",e)}function m(e){f("scrollChanged",e)}function g(e){f("imageAdded",e)}function y(){return i.mode}function b(){return i.scrollValues}function w(e){if(!i||!i[e])return;return i[e]}function E(){return document.querySelector(".webdoc_expression_wrapper")}function S(){for(var e in o){var n=o[e];if(t[n.name])throw"Extension "+n.name+" is already defined.";typeof n.module=="function"?t[n.name]=n.module.call(UT,t):t[n.name]=n.module}}function x(e,t){typeof arguments[0]=="string"?(e={value:arguments[0],max:arguments[1]},t=arguments[2]):typeof e=="function"&&(t=e,e={}),UT.Expression._callAPI("document.textInput",[e.value||null,e.max||null,e.multiline||!1],t)}function T(e,t,n){n===undefined&&typeof t=="function"&&(n=t,t={});switch(e){case"sound":UT.Expression._callAPI("medias.openSoundChooser",[t],n);break;case"image":t&&t.size&&t.size.auto&&window.console&&console.warn&&console.warn("Use of size.auto is deprecated, use size.autoCrop instead"),UT.Expression._callAPI("medias.openImageChooser",[t],function(e){n.call(this,e)});break;case"video":UT.Expression._callAPI("medias.openVideoChooser",[t],n)}}function N(){return this.getState("parentData")||{}}function C(e){switch(e.type){case"ready":k(e.options);break;case"triggerEvent":a.apply(this,[e.eventName].concat(e.eventArgs));break;case"callback":O(e.callbackId,e.result);break;case"post":L()}}function k(e){t.isReady=!0,i=e,i.readyToPost=!1,f("modeChanged",function(e){i.mode=e}),f("scrollChanged",function(e){i.scrollValues=e}),f("afterReady",function(){A("initialized")}),S(),a("ready",t)}function L(){n&&n.call(e,function(){}),UT.Expression._callAPI("posted")}function A(e){UT.Expression._callAPI("changeCurrentState",[e])}function O(e,t){var n=u[e];n&&(t&&t instanceof Array||window.console&&console.error&&console.error("received result is not an array.",t),n.apply(this,t),delete u[e])}var r=window.console&&console.log,s={};return window.addEventListener("message",function(e){try{msgObj=JSON.parse(e.data)}catch(t){console&&console.error&&console.error("receive invalid message",e.data,t.message),msgObj={}}C(msgObj)},!1),t.dialog=T,t.textInput=x,t.trigger=a,t.bind=f,t.unbind=l,t.post=c,t.modeChanged=v,t.scrollChanged=m,t.imageAdded=g,t.getMode=y,t.getScrollValues=b,t.getState=w,t.getElement=E,t.initializeExtension=S,t.getNote=d,t.setNote=h,t.readyToPost=p,t.getParentData=N,t._ready=k,t}var e,t=!1,n=null,r={},i,s=null,o=[],u={};return e={ready:f,extendExpression:a,_expression:s},e._callAPI=l,e._getInstance=c,e._reset=h,e}(),UT.Expression.extendExpression("container",function(e){var t={};return t.autoResize=function(){var t=e.getElement().scrollHeight;UT.Expression._callAPI("container.resizeHeight",[t])},t.resizeHeight=function(e,t){UT.Expression._callAPI("container.resizeHeight",[e],t)},t.setTitle=function(e){UT.Expression._callAPI("container.setTitle",[e])},popupUsers=function(e){UT.Expression._callAPI("container.popupUsers",[uerIds])},popup=function(e,t){UT.Expression._callAPI("container.popup",[e,t])},closePopup=function(){UT.Expression._callAPI("container.closePopup")},t}),UT.Expression.extendExpression("medias",function(e){return{imageDialog:function(e,t){console&&console.warn&&console.warn("Usage of imageDialog Deprecated, use expression.dialog instead"),t||(t=e,e={}),e&&e.size&&e.size.auto&&window.console&&console.warn&&console.warn("Use of size.auto is deprecated, use size.autoCrop instead"),UT.Expression._callAPI("medias.openImageChooser",[e],function(e){t.call(this,e)})},createImage:function(t,n){var r=e.readyToPost();e.readyToPost(),UT.Expression._callAPI("medias.createImage",[t],function(){e.readyToPost(r),n.apply(e,arguments)})},reCrop:function(e,t,n){if(!e._type||e._type!=="image")e={url:e};UT.Expression._callAPI("medias.reCrop",[{size:t,image:e}],function(e){n.call(this,e)})},crop:function(e,t,n){if(!e._type||e._type!=="image")e={url:e};UT.Expression._callAPI("medias.crop",[{size:t,image:e}],function(e){n.call(this,e)})},applyFilterToImage:function(e,t,n){if(!e._type||e._type!=="image")e={url:e};UT.Expression._callAPI("medias.applyFilter",[{filter:t,image:e}],function(e){n.call(this,e)})},saveImage:function(e,t,n){UT.Expression._callAPI("medias.createImage",[t],function(t,r){postMessageAPI.apply("items.save",[e,t],function(r,i){if(i){!n&&window.console&&console.error?console.error("Unable to save object with key: "+e,i.message):n&&n.call(i,null,i);return}t._id=r._id,n&&n.call(t,t,null)})})},imageWithDataUrl:function(e,t){UT.Expression._callAPI("medias.imageWithDataUrl",[e],t)},soundDialog:function(e,t){console&&console.warn&&console.warn("Usage of soundDialog Deprecated, use expression.dialog instead"),UT.Expression._callAPI("medias.openSoundChooser",[e],t)},videoDialog:function(e,t){console&&console.warn&&console.warn("Usage of videoDialog Deprecated, use expression.dialog instead"),UT.Expression._callAPI("medias.openVideoChooser",[e],t)},findImage:function(e,t){UT.Expression._callAPI("medias.findImage",[e],t)}}}),UT.Expression.extendExpression("document",function(e){return{getDocumentURL:function(){return e.getState("documentURL")},getDocumentPrivacy:function(){return e.getState("documentPrivacy")}}}),UT.Expression.extendExpression("url",function(e){var t={};return t["for"]=function(e){return t.getAssetPath(e)},t.getAssetThroughProxy=function(e){return this.proxify(this.getAssetPath(e))},t.getAssetPath=function(t){return t.indexOf("./")===0&&(t=t.substring(1)),e.getState("assetPath").indexOf("http")===-1?"http://"+e.getState("host")+"/"+e.getState("assetPath")+t:e.getState("assetPath")+t},t.proxify=function(t){var n=window.location.protocol+"//"+e.getState("host")+"/image_proxy/";if(typeof t=="string"&&t.indexOf("data:image")!==0&&t.indexOf("image_proxy")==-1){var r=t;if(t.indexOf("http://")===0)r=n+t.substring(7);else if(t.indexOf("https://")===0)r=n+t.substring(8);else{if(t.indexOf("./")===0||t.indexOf("/")===0)return t;t.indexOf("//")===0?r=n+t.substring(2):r=n+t}return r}return t},t}),FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"button":case"input":if(this.deviceIsIOS&&e.type==="file")return!0;return e.disabled;case"label":case"video":return!0;default:return/\bneedsclick\b/.test(e.className)}},FastClick.prototype.needsFocus=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"textarea":case"select":return!0;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled;default:return/\bneedsfocus\b/.test(e.className)}},FastClick.prototype.sendClick=function(e,t){"use strict";var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent("click",!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},FastClick.prototype.focus=function(e){"use strict";var t;this.deviceIsIOS&&e.setSelectionRange?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},FastClick.prototype.updateScrollParent=function(e){"use strict";var t,n;t=e.fastClickScrollParent;if(!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(e){"use strict";return e.nodeType===Node.TEXT_NODE?e.parentNode:e},FastClick.prototype.onTouchStart=function(e){"use strict";var t,n,r;t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0];if(this.deviceIsIOS){r=window.getSelection();if(r.rangeCount&&!r.isCollapsed)return!0;if(!this.deviceIsIOS4){if(n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<200&&e.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(e){"use strict";var t=e.targetTouches[0];return Math.abs(t.pageX-this.touchStartX)>10||Math.abs(t.pageY-this.touchStartY)>10?!0:!1},FastClick.prototype.onTouchMove=function(e){"use strict";if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))this.trackingClick=!1,this.targetElement=null;return!0},FastClick.prototype.findControl=function(e){"use strict";return e.control!==undefined?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(e){"use strict";var t,n,r,i,s,o=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;this.lastClickTime=e.timeStamp,n=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(s=e.changedTouches[0],o=document.elementFromPoint(s.pageX-window.pageXOffset,s.pageY-window.pageYOffset)),r=o.tagName.toLowerCase();if(r==="label"){t=this.findControl(o);if(t){this.focus(o);if(this.deviceIsAndroid)return!1;o=t}}else if(this.needsFocus(o)){if(e.timeStamp-n>100||this.deviceIsIOS&&window.top!==window&&r==="input")return this.targetElement=null,!1;this.focus(o);if(!this.deviceIsIOS4||r!=="select")this.targetElement=null,e.preventDefault();return!1}if(this.deviceIsIOS&&!this.deviceIsIOS4){i=o.fastClickScrollParent;if(i&&i.fastClickLastScrollTop!==i.scrollTop)return!0}return this.needsClick(o)||(e.preventDefault(),this.sendClick(o,e)),!1},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onClick=function(e){"use strict";var t;return this.targetElement?e.forwardedTouchEvent?!0:(t=this.targetElement,this.targetElement=null,this.trackingClick?(this.trackingClick=!1,!0):e.cancelable?e.target.type==="submit"&&e.detail===0?!0:!this.needsClick(t)||this.cancelNextClick?(this.cancelNextClick=!1,e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0):!0},FastClick.prototype.destroy=function(){"use strict";var e=this.layer;e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},typeof define!="undefined"&&define.amd&&define(function(){"use strict";return FastClick}),typeof module!="undefined"&&module.exports&&(module.exports=function(e){"use strict";return new FastClick(e)},module.exports.FastClick=FastClick),UT.Expression.extendExpression("collections",function(e){var t=e.getState("documentId"),n=e.getState("collections"),r=e.getState("currentUserId");if(t&&n){var i=new UT.CollectionStore({data:n,currentUserId:r,delegate:{save:function(e,t,n){UT.Expression._callAPI("collections.save",[e,t],n)},authenticate:function(e){UT.Expression._callAPI("authenticate")}}});return e.storage=i.get("default"),i}}),UT.Expression._getInstance();
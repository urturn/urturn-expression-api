var UT={},WD=UT;UT.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)})},UT.UUID=UT.uuid,function(){"use strict";try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(e,t){Object.defineProperty(this,e,{get:t,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(e,t){Object.defineProperty(this,e,{set:t,enumerable:!0,configurable:!0})}}))}catch(e){throw Error("Simple Storage API not Supported")}}(),UT.touchEventFix=function(e,t){"use strict";function n(){var n=function(){var e=arguments[0],n=arguments[1],o=!0;"touchstart"!==e&&"touchend"!==e&&"touchcancel"!==e&&"touchmove"!==e&&"touchleave"!==e||"function"!=typeof n||(g?(this.__UT__uuid=this.__UT__uuid||c(),m[this.__UT__uuid]=m[this.__UT__uuid]||{},m[this.__UT__uuid][e]={node:this,callback:n}):o=!1),y("_"),y("->> Called addEventListener, type: "+e+", in iframe: "+t+", will be added: "+o),o&&h.apply(this,arguments)},o=function(){var e=arguments[0],t=arguments[1];"touchstart"!==e&&"touchend"!==e&&"touchcancel"!==e&&"touchmove"!==e&&"touchleave"!==e||"function"!=typeof t||m[this.__UT__uuid]&&m[this.__UT__uuid][e]&&delete m[this.__UT__uuid][e],d.apply(this,arguments)};e.Element.prototype.addEventListener=n,e.Element.prototype.removeEventListener=o,e.document.addEventListener=n,e.document.removeEventListener=o}function o(){("TEXTAREA"==e.document.activeElement.nodeName||"INPUT"==e.document.activeElement.nodeName||e.document.activeElement.getAttribute("contenteditable"))&&r()}function i(){var n,o,i,r,a;g=!0,y("->> enableTouchEvents"),t&&e.top.postMessage('"touchevents-enable"',"*");for(var s in m)m.hasOwnProperty(s)&&(n=m[s].touchstart,o=m[s].touchend,i=m[s].touchcancel,r=m[s].touchmove,a=m[s].touchleave,n&&h.call(n.node,"touchstart",n.callback,!1),o&&h.call(o.node,"touchend",o.callback,!1),i&&h.call(i.node,"touchcancel",i.callback,!1),r&&h.call(r.node,"touchmove",r.callback,!1),a&&h.call(a.node,"touchleave",a.callback,!1))}function r(){var n,o,i,r,a;g=!1,y("->> disableTouchEvents"),t&&e.top.postMessage('"touchevents-disable"',"*");for(var s in m)m.hasOwnProperty(s)&&(n=m[s].touchstart,o=m[s].touchend,i=m[s].touchcancel,r=m[s].touchmove,a=m[s].touchleave,n&&d.call(n.node,"touchstart",n.callback,!1),o&&d.call(o.node,"touchend",o.callback,!1),i&&d.call(i.node,"touchcancel",i.callback,!1),r&&d.call(r.node,"touchmove",r.callback,!1),a&&d.call(a.node,"touchleave",a.callback,!1))}function a(){t&&(h.call(e.document,"focus",o,!0),h.call(e.document,"blur",i,!0)),e.addEventListener("message",l,!0)}function s(){t&&(d.call(e.document,"focus",o,!0),d.call(e.document,"blur",i,!0)),e.removeEventListener("message",l,!0)}function l(e){y("didReceiveMessage "+e.data),"touchevents-enable"===e.data?i():"touchevents-disable"===e.data&&r()}function c(){return parseInt(p++,10)}function u(){console.group("EventListeners description:");for(var e in m)console.group("%s:",e),m.hasOwnProperty(e)&&y(m[e]),console.groupEnd();console.groupEnd()}if(!/(iPad|iPhone|iPod)/g.test(e.navigator.userAgent)||!Element.prototype.addEventListener)return null;var f,h=e.Element.prototype.addEventListener,d=e.Element.prototype.removeEventListener,p=0,m={},g=!0,v=!1;n(),a();var y=function(e){v&&console.log(e)};return f={enableCapture:a,disableCapture:s,enableTouchEvents:i,disableTouchEvents:r,getEventListenersDescription:u,didReceiveMessage:l}}(window,!0),__STACK_JQUERY_JS=null,function(e,t,n,o){"use strict";e.Collection=function(t){var n,i,r,a,s,l,c,u,f,h,d=this;this.length=0,this.name=null,this.isPublic=function(){return!1};var p=this.setItem=function(t,n){if(!t)throw Error("InvalidKey",t);if(e.Collection.isReservedKey(t))throw Error("ReservedKey",t);var i=a[t],r=v(t,n);return r||a[t]?(!i||null!==r&&r!==o?!i&&r?(f++,l.push(t),a[t]=r):a[t]=r:(l.splice(l.indexOf(t),1),f--,delete a[t]),-1==c.indexOf(t)&&c.push(t),d.length=l.length,s[t]=n,n):r},m=function(e){return-1===u.indexOf(e)&&d[e]!==o?d[e]:o},g=this.getItem=function(t,n){if(!t)return null;var i=s[t];return i||(i=e.Collection.buildItem(a[t]),i===o&&(i=m(t)),i===o&&(i=n),s[t]=i),i};this.key=function(e){return e>=l.length?null:l[e]},this.count=function(){return f},this.toString=function(){return'<Collection @name="'+d.name+'">'},this.save=function(){w();var t={};if(c.length>0){for(var n=0;c.length>n;n++)t[c[n]]=e.Collection.marshallItem(a[c[n]]);i.save(d.name,t),c=[]}},this.getCurrentData=function(){var e={name:d.name,count:f,definition:r.definition,operations:[],items:[],"public":!1};if(r.operations)for(var t=0;r.operations.length>t;t++){var n={operation:r.operations[t].operation,field:r.operations[t].field};opsToolbox[n.operation].toJsonData(h[n.field],n),e.operations.push(n)}for(var o in a){var i=a[o];i._key=o,e.items.push(i)}return e},this.refresh=function(e){y.call(d,{currentUserId:n,delegate:i,data:e})};var v=e.Collection.sanitizeItem,y=function(t){e.Collection.validateOptions(t),h={},l=[],c=[],u=[],n=t.currentUserId,i=t.delegate,r=t.data,d.name=r.name,f=r.count,_(r.items)},_=function(e){if(a={},s={},e){for(var t=0;e.length>t;t++){var n=e[t],o=n._key;a[o]=n,E(o,n),l.push(o)}d.length=l.length}},E=function(t){-1!=u.indexOf(t)||e.Collection.isReservedKey(t)||(u.push(t),d.__defineGetter__(t,function(){return g.call(d,t)}),d.__defineSetter__(t,function(e){return p.call(d,t,e)}))},w=function(){for(var t=Object.keys(d),n=t.length-1;n>=0;n--){var o=t[n];e.Collection.isReservedKey(o)||-1!=u.indexOf(o)||(p(o,d[o]),E(o,d[o]))}};y(t)},e.Collection.RESERVED_KEYS=["refresh","setItem","getItem","count","sum","key","isPublic","getUserItem","setUserItem","average","toString","size","length","name","save","fieldDefs","sanitizedItem","getCurrentData"],e.Collection.isReservedKey=function(t){return e.Collection.RESERVED_KEYS.indexOf(t)>=0},e.Collection.validateOptions=function(e){if(!e.data)throw Error("ArgumentError","missing data");if(!e.data.name)throw Error("ArgumentError","no name in data");if(e.data.count===o)throw Error("ArgumentError","no count in data")},e.Collection.marshallItem=function(e){return e&&e.marshall?e.marshall():e!==o&&null!==e?e:null},e.Collection.sanitizeItem=function(t,n){if("function"==typeof n)throw Error("ArgumentError cannot serialize function");var o=e.Collection.marshallItem(n);if(null!==o){if(("object"!=typeof o||[].constructor===o.constructor)&&(o={_type:"literal",value:o}),o._key=t,!o||o.constructor!=={}.constructor)throw Error("Unserialisable object");return JSON.parse(JSON.stringify(o))}return null},e.Collection.buildItem=function(t){return t&&t._type&&e.Collection.ItemBuilders[t._type]?e.Collection.ItemBuilders[t._type](t):t},e.Collection.ItemBuilders={image:function(t){return new e.Image(t)},sound:function(t){return new e.Sound(t)},video:function(t){return new e.Video(t)},literal:function(e){return e.value}}}(UT,window,document,void 0),UT.CollectionStore=function(e){this.data=e.data;var t=e.delegate;t.store=this;for(var n={},o=0;this.data.length>o;o++){var i=this.data[o],r=i.name;if(!r)throw Error("ArgumentError","data contains unamed collections.");n[r]=i.public?new UT.PublicCollection({data:i,postMessageApi:e.postMessageApi,currentUserId:e.currentUserId,delegate:t}):new UT.Collection({data:i,postMessageApi:e.postMessageApi,currentUserId:e.currentUserId,delegate:t})}this.get=function(e){return n[e]},this.set=function(e){n[e.name]=e},this.each=function(e){for(var t in n)e(n[t])},this.flush=function(){t.flush()},this.getCurrentData=function(){i=[];for(var e in n)i.push(n[e].getCurrentData());return i},this.refresh=function(e,n){t.refreshCollections(e,n)}},function(e,t,n,o){"use strict";var i=["recent","friends"];e.PublicCollection=function(t){this.length=0,this.name=null;var n=null,r=!1;this.isPublic=function(){return!0},this.setUserItem=function(e){if(!l)throw c.authenticate(),Error("ArgumentError","No currentUserId defined");var t=l,i=s(t,e),a=n;return i||a?(p(a,i),!a||null!==i&&i!==o?!a&&i?(h++,n=i):n=i:(h--,n=null),r=!0,n):i};var a=this.getUserItem=function(){return l?n:o};this.average=function(e){return f[e]?f[e].average:o},this.sum=function(e){return f[e]?f[e].sum:o};var s=function(t,n){var i=e.Collection.sanitizeItem(t,n),r=u.definition.fields;if(n&&r&&r.length>0){for(var a=!1,s=0;r.length>s;s++){var l=r[s];if(n[l.name]!==o)if(a=!0,"string"==l.type)i[l.name]=n[l.name];else if("number"==l.type){var c=parseFloat(n[l.name]);if(isNaN(c)||!isFinite(n[l.name]))throw Error("TypeError","Wrong value for field note");i[l.name]=c}else{if("boolean"!=l.type)throw Error("TypeError","Unknown type "+l.type);i[l.name]=!!n[l.name]}}if(!a)throw Error("InvalidItemError no valid field specified")}return i};this.count=function(e){if(!e)return h;if(f[e])return f[e]?f[e].count:o},this.toString=function(){return'<PublicCollection @name="'+this.name+'">'},this.save=function(){if(r){var t={};t[l]=e.Collection.marshallItem(n),c.save(this.name,t),r=!1}},this.getCurrentData=function(){var e={name:this.name,count:h,definition:u.definition,operations:[],items:[],"public":!0};if(u.operations)for(var t=0;u.operations.length>t;t++){var o={operation:u.operations[t].operation,field:u.operations[t].field};d[o.operation].toJsonData(f[o.field],o),e.operations.push(o)}a()&&(n._key=l,e.items.push(a()));for(var i=0;u.items.length>i;i++)u.items[i]._key&&u.items[i]._key!=l&&e.items.push(u.items[i]);return e},this.find=function(e,t){if("function"==typeof e&&(t=e,e={filters:{recent:!0}}),"string"==typeof e){if(-1===i.indexOf(e))throw Error("invalid filter ("+e+")");var n={};n[e]=!0,e={filters:n}}if(!t||"function"!=typeof t)throw Error("missing callback argument");c.find(this.name,e,t)},this.refresh=function(e){m.call(this,{currentUserId:l,delegate:c,data:e})};var l,c,u,f,h,d={_transfer:function(e,t){for(var n=Array.prototype.slice.call(arguments,2),o=n.length-1;o>=0;o--)t[n[o]]=e[n[o]]},average:{fromJsonData:function(e,t){t.average===o||t.average_count===o?(e.average=-1,e.average_count=0):d._transfer(t,e,"average","average_count")},toJsonData:function(e,t){d._transfer(e,t,"average","average_count")},recompute:function(e,t,n,i){var r=e.average_count;n&&n[t.field]!==o&&(e.average=1===r?-1:(e.average*r-n[t.field])/parseFloat(r-1),r--),i&&i[t.field]!==o&&(e.average=(e.average*r+i[t.field])/parseFloat(r+1),r++),e.average_count=r}},count:{fromJsonData:function(e,t){t.count===o?e.count=0:d._transfer(t,e,"count")},toJsonData:function(e,t){d._transfer(e,t,"count")},recompute:function(e,t,n,i){n&&n[t.field]&&n[t.field]!==o&&(e.count=e.count-1),i&&i[t.field]&&i[t.field]!==o&&e.count++}},sum:{fromJsonData:function(e,t){t.sum===o?e.sum=0:d._transfer(t,e,"sum")},toJsonData:function(e,t){d._transfer(e,t,"sum")},recompute:function(e,t,n,i){n&&n[t.field]&&n[t.field]!==o&&(e.sum=e.sum-n[t.field]),i&&i[t.field]&&i[t.field]!==o&&(e.sum=e.sum+i[t.field])}}},p=function(e,t){if(u.operations)for(var n=0;u.operations.length>n;n++){var i=u.operations[n];(t&&t[i.field]!==o||e&&e[i.field]!==o)&&d[i.operation].recompute(f[i.field],i,e,t)}},m=function(t){if(e.Collection.validateOptions(t),f={},l=t.currentUserId,c=t.delegate,u=t.data,this.name=u.name,h=u.count,u.operations)for(var n=0;u.operations.length>n;n++){var o=u.operations[n];f[o.field]=f[o.field]||{},d[o.operation].fromJsonData(f[o.field],o)}g.call(this,u.items)},g=function(e){if(e)for(var t=0;e.length>t;t++){var o=e[t],i=o._key;i==l&&(n=o)}};m.call(this,t)}}(UT,window,document,void 0),function(e,t){"use strict";var n,o,i=[],r={},a=!1;e.Expression=function(){throw Error("StaticClass")},e.Expression.ready=function(e){a?(e.call(this,n),s("changeCurrentState",["initialized"])):-1===i.indexOf(e)&&i.push(e)},e.Expression.apiVersion=function(){return o&&o.apiVersion||"1.2.11-alpha1-vanilla"},e.Expression.version=function(){return o&&o.version||null};var s=e.Expression._callAPI=function(i,a,s){if("collections.save"==i&&!n.isDisplay())return l.push({methodName:i,args:a,callback:function(){}}),s&&s(),undefined;var c={type:"ExpAPICall",methodName:i,args:a,expToken:o?o.expToken:null};if(s){var u=""+e.uuid();r[u]=s,c.callbackId=u}var f=JSON.stringify(c);t.parent.postMessage(f,"*")},l=[];e.Expression._resolveCallAPIStack=function(){for(var e=0;l.length>e;)s(l[e].methodName,l[e].args,l[e].callback),++e;l=[]};var c=function(e,n){var o=r[e];o&&(n&&n instanceof Array||t.console&&console.error&&console.error("received result is not an array.",n),o.apply(this,n),delete r[e])},u=function(t){o=t,a=!0,o.readyToPost=!1,n=new e.Post(o),n.on("scroll",function(e){o.scrollValues=e});for(var r=0;i.length>r;r++)i[r].call(n,n);i=[],s("changeCurrentState",["initialized"])},f=function(){n.fire("publish"),s("posted")},h=function(){n.fire("pause")};e.Expression._dispatch=function(e){switch(e.type){case"ready":u(e.options);break;case"triggerEvent":n.fire.apply(n,[e.eventName].concat(e.eventArgs));break;case"callback":c(e.callbackId,e.result);break;case"post":f();break;case"pause":h();break;case"media":n.fire("media",e.eventArgs[0])}},e.Expression._reset=function(){i=[],r=[],n=null,a=!1,o=null},e.Expression._postInstance=function(){return n=n}}(UT,window,document,void 0),function(e){"use strict";e.User=function(e){this.username=e.username,this.avatar=function(){return e.avatar},this.uuid=e.uuid,this.numberOfPost=e.numberOfPost,this.numberOfUse=e.numberOfUse},e.User.prototype.marshall=function(){return{_type:"user",uuid:this.uuid}}}(UT),function(e,t,n,o){"use strict";e.Post=function(i){if(!i||!i.collections)throw Error("ArgumentError","Missing collections in state arguments");var r,a=this,s={height:0,width:0},l={scrollTop:0,scrollBottom:0},c={},u={},f=(/(urturn)/i.test(navigator.userAgent),new e.CollectionStore({data:i.collections,currentUserId:i.currentUserId,delegate:{save:function(t,n,o){e.Expression._callAPI("collections.save",[t,n],o)},authenticate:function(){e.Expression._callAPI("authenticate")},find:function(t,n,o){e.Expression._callAPI("collections.find",[t,n],o)}}}));if(i.parentData){var h=[];for(var d in i.parentData){try{i.parentData[d]._key=d}catch(p){t.console&&console.log&&console.log("Unexpected Error: "+p)}h.push(i.parentData[d])}r=new e.Collection({data:{name:"parent",items:h,count:h.length},delegate:{save:function(){throw Error("ReadOnly collection")},authenticate:function(){throw Error("ReadOnly collection")}},currentUserId:i.currentUserId})}i.parameters;var m=function(t){return i.note=t,e.Expression._callAPI("document.setNote",[i.note]),a.fire("noteUpdated"),t};this.__defineGetter__("note",function(){return i.note}),this.__defineSetter__("note",function(e){return m(e)});var g=this.context={player:!1,editor:!1,sandbox:!1,thumbnail:!1,privacy:null,mediaFirst:!1};"edit"==i.mode?g.editor=!0:"view"==i.mode&&(g.player=!0),i.sandbox===!0&&(g.sandbox=!0),g.privacy=i.documentPrivacy,i.mediaFirst===!0&&(g.mediaFirst=!0),g.player&&(__STACK_JQUERY_JS=[]),this.url=i.documentURL;var v=this.node=n.querySelector(".webdoc_expression_wrapper");if(!v)throw Error("Missing wrapper node");var y=function(t,n){"function"==typeof t&&(n=t,t={}),e.Expression._callAPI("document.textInput",[t.value||null,t.max||null,t.multiline||!1],n)},_=function(t,n,i){n&&e.Expression._callAPI("medias.openImageChooser",[t],function(t){if(null===t&&2===arguments.length&&"cameraNotFound"===arguments[1])return i?i({type:"cameraNotFound",message:"User camera can not be found."}):n(null),o;if(null===t)return i?i({type:"userQuitDialog",message:"User quit the dialog without selecting a media."}):n(null),o;var r=new e.Image;r.init(t),n.call(a,r)})},E=function(t,n,i){n&&e.Expression._callAPI("medias.openSoundChooser",[t],function(t){if(null===t)return i?i({type:"userQuitDialog",message:"User quit the dialog without selecting a media."}):n(null),o;var r=new e.Sound(t);n.call(a,r)})},w=function(t,n,i){e.Expression._callAPI("medias.openVideoChooser",[t],function(t){if(null===t)return i?i({type:"userQuitDialog",message:"User quit the dialog without selecting a media."}):n(null),o;var r=new e.Video(t);n.call(a,r)})},b=function(t,n,i){t.image.descriptor&&(t.image=t.image.descriptor),e.Expression._callAPI("medias.crop",[t],function(r){if(null===r)return i?i({type:"userQuitDialog",message:"User quit the dialog without selecting a media."}):n(null),o;var s=null;t.image.init?(t.image.init(r),s=t.image):(s=new e.Image,s.init(r)),n.call(a,s)})},x=function(t,n){if("function"==typeof t&&(n=t,t={}),t.items){t.users=t.users||[];for(var o=0;t.items.length>o;o++)t.users.push(t.items[o]._key);delete t.items}t.title&&(t.label=t.title,delete t.title),a.context.player&&t.users&&0!==t.users.length?e.Expression._callAPI("dialog.users",[t],function(){n.apply(a)}):n.apply(a)},I={text:y,image:_,sound:E,video:w,crop:b,users:x},k=function(t){e.Expression._callAPI("dialog.suggestRotation",[t],function(){})},U={suggestRotation:k};this.notification=function(e,t){if(!U[e])throw Error("InvalidArgument","unknown notification type "+e);U[e](t)};var T=this.fire=function(t){"scrollChanged"===t&&(t="scroll");var n,o,i,r,s,c,f=u[t],h=[];if("scroll"==t&&(f=f?f.concat(u.scrollChanged):u.scrollChanged),f){switch(r=Array.prototype.slice.call(arguments,1),s=0!==r.length?r[0]:a,t){case"scroll":l.scrollTop=r[0].scrollTop,l.scrollBottom=r[0].scrollBottom;break;case"image":var d=new e.Image;d.init(r[0]),r[0]=d}for(f=f.slice(0),n=f.length,o=-1;n>++o;)i=f[o],i&&(c=i.apply(s,r),c&&"function"==typeof c.then&&h.push(c));var p="after"+t.charAt(0).toUpperCase()+t.slice(1);h.length>0?when.all(h).then(function(){T(p)}):T(p)}},A=this.on=function(e,t){var n=u[e]||(u[e]=[]);"function"==typeof t&&n.push(t)};this.off=function(e,t){var n,i=u[e];if(i){if(!t)return delete u[e],o;for(n=i?i.indexOf(t):-1;-1!==n;)i.splice(n,1),n=i.indexOf(t)}},this.valid=function(t){return t!==o&&t!=i.readyToPost&&(i.readyToPost=!!t,e.Expression._callAPI("document.readyToPost",[i.readyToPost])),i.readyToPost},this.imageAdded=function(e){A("imageAdded",e)};var P=function(){a.node.style.display="block"},C=function(){};this.dialog=function(e,t,n){n===o&&"function"==typeof t&&(n=t,t={});var i=null;4==arguments.length&&"function"==typeof arguments[3]&&(i=arguments[3]),C();var r=l.scrollTop,a=l.scrollBottom,s=this,c=function(){P(),n&&(s.scroll({scrollTop:r,scrollBottom:a},function(){}),n.apply(this,arguments))},u=null;if(i&&(u=function(){P(),i&&(s.scroll({scrollTop:r,scrollBottom:a},function(){}),i.apply(this,arguments))}),!I[e])throw Error("InvalidArgument","unknown dialog type "+e);I[e](t,c,u)},this.size=function(t,n){if("function"==typeof t&&(n=t,t=null),t){var o;"number"==typeof t?o=t:t&&"auto"==t?o=v.offsetHeight:t&&t.height&&(o="string"==typeof t.height&&t.height.match&&t.height.match(/^[0-9]+px$/)?t.height.substring(0,t.height.length-2):t.height);var i=null;return n&&(i=function(){n(new e.ResizeEvent(s.width,s.height))}),e.Expression._callAPI("container.resizeHeight",[o,!0],i),this}var r=new e.ResizeEvent(s.width,s.height);return n?(n(r),this):r};var O=!1;this.isDisplay=function(){return O},this.display=function(){O=!0,e.Expression._resolveCallAPIStack(),e.Expression._callAPI("container.display",[],function(){})},this.stopAllOther=function(){e.Expression._callAPI("document.stopAllOther",[],function(){})},this.scroll=function(t,n){if("function"==typeof t&&(n=t,t=null),t)return e.Expression._callAPI("container.scroll",[t.scrollTop||t.scrollBottom,t.scrollTop?"top":"bottom"],function(t){l.scrollTop=t.scrollTop,l.scrollBottom=t.scrollBottom,n&&n(new e.ScrollEvent(t.scrollTop,t.scrollBottom))}),this;var o=new e.ScrollEvent(l.scrollTop,l.scrollBottom);return n?(n(o),this):o},this.pushNavigation=function(t,n){e.Expression._callAPI("container.pushNavigation",[t],n)},this.popNavigation=function(){e.Expression._callAPI("container.popNavigation")},this.queueUp=function(t,n){return n?c[t]!==o?(n(c[t]),this):(c[t]=-1,e.Expression._callAPI("document.queueUp",[t],function(e){c[t]=e,n(e)}),this):this},this.navigate=function(t){var n={};arguments.length>=2?n=arguments[1]:1===arguments.length&&(n=t,t="browse");var o={app:t,parameters:n};e.Expression._callAPI("container.navigate",[o])};var S=this.collection=function(e){return"parent"==e?r||null:f.get(e)};this.save=function(){f.each(function(e){(g.editor||e.isPublic())&&e.save()})},this.enableRotation=function(t){e.Expression._callAPI("container.enableRotation",[t],function(){})},this.urturn=function(t){e.Expression._callAPI("document.urturn",[t],function(){})},this.post=function(t){e.Expression._callAPI("document.post",[t],function(){})},this.geoLocation=function(t){e.Expression._callAPI("document.geoLocation",[],function(e,n){t(e,n)})};var D=!1;this.isStatic=function(t){return t!==o&&this.context.editor&&(D=t,e.Expression._callAPI("document.isStatic",[t],function(){})),t||D},this.autoLink=function(e){var t=/(^|\s|<br\/>|\.)#([A-Za-z0-9_\-ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõöøùúûüýþş]+)/g,n=/(^|\s|<br\/>|\.)@([A-Za-z0-9_\-.]+)/g,o='$1<a href="search:#$2" class="ut-navigate-hashtag">#$2</a>',i='$1<a href="user:$2" class="ut-navigate-mention">@$2</a>';return e=e.replace(t,o),e=e.replace(n,i),e=e.replace(/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(e){var t=e;return t.match("^https?://")||(t="http://"+t),'<a href="'+t+'" class="ut-navigate-url">'+e+"</a>"})},this.follow=function(t,n,o){e.Expression._callAPI("dialog.follow",[t,n],function(){o()})},this.getFollowers=function(t,n){1==arguments.length&&" function"==typeof arguments[0]&&(n=t,t=0),e.Expression._callAPI("document.followship",["follower",t],function(e){n(e)})},this.getFollowing=function(t,n){1==arguments.length&&" function"==typeof arguments[0]&&(n=t,t=0),e.Expression._callAPI("document.followship",["following",t],function(e){n(e)})},this.users=function(t,n){if("function"==typeof t&&(n=t,t="current"),n)if("current"===t)e.Expression._callAPI("document.getUserData",[],function(t){var o=t?new e.User(t):null;n(o,null)});else if("[object Array]"===Object.prototype.toString.call(t)){for(var o=[],i=0;t.length>i;i++)t[i]._key&&o.push(t[i]._key);e.Expression._callAPI("document.users",[o],function(o){for(var i=[],r=[],a=0;t.length>a;a++)for(var s=0;o.length>s;s++)if(t[a]._key==o[s].uuid){i.push(new e.User(o[s])),r.push(t[a]);break}n(i,r)})}else e.Expression._callAPI("document.users",[[t._key]],function(o){var i=o[0];i?n(new e.User(i),t):n(null,null)})},this.isOwner=function(e){return e.uuid==i.postUserId},this.isCurrentUser=function(e){return e.uuid==i.currentUserId};var F=function(){s.width=t.innerWidth,s.height=t.innerHeight},N=null,R=null;e.touchEventFix&&(N=e.touchEventFix.enableTouchEvents,R=e.touchEventFix.disableTouchEvents),this.on("enabletouchevents",N),this.on("disabletouchevents",R),this.on("shouldUpdateNote",function(e){i.note=e,a.fire("noteUpdated")}),this.storage=S("default"),t.addEventListener("resize",function(){F(),a.fire("resize",new e.ResizeEvent(s.width,s.height))},!1),F(),t.addEventListener("click",function(e){var t=e.target.getAttribute("href");if(t&&t.match(/^(search|user|http)/gi)){var n=t.split(":")[0],o=t.substring(t.indexOf(":")+1);("http"==n||"https"==n)&&(n="browse",o=t),e.preventDefault(),a.navigate(n,o)}},!1)}}(UT,window,document,void 0),UT.Image=function(e){this.url="",this.info={},this.type="image",this.crop=function(e,t){UT.Expression._callAPI("medias.recrop",[{size:e,image:this.descriptor}],function(e){this.init(e),t.call(this,this)}.bind(this))},this.autocrop=function(e,t,n){UT.Expression._callAPI("medias.crop",[{size:{width:e,height:t,auto:!0},image:this.descriptor}],function(e){this.init(e),n.call(this,this)}.bind(this))},this.filter=function(e,t){UT.Expression._callAPI("medias.applyFilter",[{filter:e,image:this.descriptor}],function(e){this.init(e),t.call(this,this)}.bind(this))},this.editable=function(e){UT.Expression._callAPI("medias.getEditableImage",[this.url],function(t){this.url=t,e.call(this,this)}.bind(this))},this.marshall=function(){return this.descriptor._type="image",this.descriptor},this.node=function(e){var t=new Image;t.onload=function(){e.call(t,t)},t.src=this.url},this.init=function(e){"string"==typeof e?(this.url=e,this.descriptor={},this.descriptor.url=e,this.descriptor._type="image"):e&&e.url&&(this.url=e.url,this.descriptor=e,this.info=e.info,e.center&&(this.info.crop=e.center))},this.descriptor={},e&&this.init(e)},UT.Video=function(e){function t(e){this.url=e.url,this.appData=e.appData,n=e}this.url="",this.type="video",this.marshall=function(){return n.url=this.url,n._type="video",n.appData=this.appData,n};var n={};t.call(this,e)},UT.Sound=function(e){function t(e){n=e,this.service=e.service,this.url=e.url,this.title=e.title,this.artist=e.artist,this.cover=e.cover,this.artistCover=e.artistCover,this.soundCover=e.soundCover,this.waveFormImage=e.waveFormImage,this.link=e.link,this.appData=e.appData}this.service="",this.url="",this.title="",this.artist="",this.cover="",this.artistCover="",this.soundCover="",this.waveFormImage="",this.link="",this.appData={},this.marshall=function(){return{_type:"sound",service:this.service,url:this.url,title:this.title,artist:this.artist,cover:this.cover,artistCover:this.artistCover,soundCover:this.soundCover,waveFormImage:this.waveFormImage,link:this.link,appData:this.appData}};var n={};t.call(this,e)},function(e){e.ResizeEvent=function(e,t){this.height=t,this.width=e},e.ScrollEvent=function(e,t){this.scrollTop=e,this.scrollBottom=t}}(UT),("ontouchstart"in window||"onmsgesturechange"in window)&&(document.querySelector("html").className=document.querySelector("html").className+" touch","undefined"!=typeof FastClick&&window.addEventListener("load",function(){new FastClick(document.body)},!1)),window.addEventListener("message",function(e){try{msgObj=JSON.parse(e.data)}catch(t){console&&console.error&&console.error("received invalid message",e.data,t.message),msgObj={}}UT.Expression._dispatch(msgObj)},!1),function(e){"use strict";e.preloader={},e.preloader.waitFor=function(e,t){t===undefined&&(t=!1);var n={keys:{},callback:{loadstart:function(){},progress:function(){},load:function(){}}},o=function(){return(new Date).getTime()},i=function(e){e.map(function(e){n.keys[e]={ready:!1,startTime:o()}})},r=function(e){var i=this;if(!n.keys[e])return console.error("wrong key, that was not defined for waitFor"),undefined;n.keys[e].ready=!0,n.keys[e].endTime=o(),n.keys[e].delay=n.keys[e].endTime-n.keys[e].startTime,t&&console&&console.log&&console.log(" -- waitFor:progress: key:"+e),n.callback.progress.call(i,n.keys);for(var r in n.keys)if(!n.keys[r].ready)return;if(t&&console&&console.group){console.group(" -- waitFor:load",n.keys);for(var a in n.keys)console.log(a," = ",n.keys[a].delay+"ms");console.groupEnd()}n.callback.load.call(i,n.keys)},a=function(e,t){if(!t)return r(e),console&&console.warn&&console.warn("You have to specify image url as a second parameter of readyImage(key, url).. currently url="+name),undefined;var i=new Image;i.onload=function(){r(e)},i.onerror=function(){r(e)},n.keys[e].startTime=o(),n.keys[e].url=t,i.src=t},s=function(e,i){return i?(n.keys[e].startTime=o(),n.keys[e].fontName=i,fontdetect.onFontLoaded(i,function(){r(e)},function(){t&&console.error('We was not able to load the font "'+i+'" in 5 sec...'),r(e)},{msInterval:30,msTimeout:5e3}),undefined):(r(e),console&&console.warn&&console.warn("You have to specify font name as a second parameter of readyFont(key, fontName).. currently fontname="+i),undefined)};return n.on=function(e,t){return n.callback[e]=t,n},n.ready=function(e){return r(e),n},n.readyImage=function(e,t){return a(e,t),n},n.readyFont=function(e,t){return s(e,t),n},i(e),n}}(UT,window,document,void 0);